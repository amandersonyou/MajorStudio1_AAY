/*
 * Note that this function uses *synchronous* JavaScript
 * There is a 2-second (2000 milliseconds) timer after which the JSON will be downloaded
 * so if the API calls are not finished by then, the JSON will only have the ones that did finish.
 * You can increase the timer if you need to.
 */

// load a default library that lets us read/write to the file system
var fs = require('fs');
// load a default library that lets us make HTTP requests (like calls to an API)
var request = require('request');

// endpoint URL
const url = 'https://collectionapi.metmuseum.org/public/collection/v1/objects';

// object Ids I want to download
const myObjectIds = [
// 10035,
// 10131,
// 10142,
// 10149,
// 10150,
// 10152,
// 10155,
// 10156,
// 10158,
// 10180,
// 10181,
// 10182,
// 10183,
// 10186,
// 10190,
// 10194,
// 10338,
// 10352,
// 10353,
// 10377,
// 10437,
// 10438,
// 10442,
// 10443,
// 10444,
// 10445,
// 10446,
// 10448,
// 10449,
// 10451,
// 10453,
// 10460,
// 10463,
// 10480,
// 10493,
// 10496,
// 10500,
// 10501,
// 10508,
// 10510,
// 10570,
// 10578,
// 10589,
// 10590,
// 10629,
// 10705,
// 10708,
// 10767,
// 10768,
// 10769,
// 10777,
// 10785,
// 10786,
// 10790,
// 10796,
// 10810,
// 10833,
// 10894,
// 10922,
// 10944,
// 10947,
// 10959,
// 11006,
// 11008,
// 11028,
// 11029,
// 11031,
// 11034,
// 11035,
// 11036,
// 11038,
// 11042,
// 11052,
// 11061,
// 11062,
// 11080,
// 11081,
// 11088,
// 11105,
// 11107,
// 11123,
// 11170,
// 11182,
// 11199,
// 11205,
// 11226,
// 11230,
// 11232,
// 11233,
// 11234,
// 11235,
// 11253,
// 11256,
// 11279,
// 11289,
// 11290,
// 11312,
// 11313,
// 11318,
// 11322,
// 11323,
// 11328,
// 11379,
// 11396,
// 11403,
// 11405,
// 11451,
// 11515,
// 11518,
// 11524,
// 11598,
// 11623,
// 11630,
// 11641,
// 11658,
// 11692,
// 11774,
// 11809,
// 11834,
// 11835,
// 11853,
// 11857,
// 11864,
// 11894,
// 11934,
// 11975,
// 11977,
// 12110,
// 12122,
// 12302,
// 12541,
// 12572,
// 12687
// 12764,
// 12765,
// 12786,
// 12796,
// 12797,
// 12801,
// 12811,
// 12835,
// 12840,
// 12855,
// 12856,
// 12872,
// 12878,
// 12904,
// 12933,
// 12962,
// 12968,
// 13017,
// 13018,
// 13033,
// 13058,
// 13089,
// 13108,
// 13178,
// 13180,
// 13184,
// 13312,
// 13313,
// 13351,
// 13353,
// 13356,
// 13392,
// 13454,
// 14203,
// 14204,
// 14419,
// 14476,
// 14479,
// 15587,
// 16881,
// 17517,
// 17574,
// 18354,
// 18447,
// 19225,
// 19231,
// 19248,
// 19250,
// 19258,
// 19264,
// 19286,
// 19289,
// 19293,
// 19294,
// 19295,
// 19300,
// 19332,
// 19337,
// 19341,
// 19342,
// 19345,
// 20639,
// 20889,
// 20891,
// 36116,
// 37856,
// 37869,
// 37945,
// 37974,
// 38020,
// 40337,
// 40338,
// 40353,
// 40429,
// 40432,
// 42344,
// 45070,
// 48985,
// 49617,
// 51595,
// 54912,
// 57187,
// 57190,
// 57192,
// 64533,
// 64535,
// 65594,
// 73261,
// 74691,
// 76393
// 282527,
// 282571,
// 387147,
// 435922,
// 435979,
// 435987,
// 436014,
// 436057,
// 436329,
// 436410,
// 436527,
// 436536,
// 437106,
// 437121,
// 437171,
// 437367,
// 437686,
// 437998,
// 438123,
// 438128,
// 438848,
// 439333,
// 439350,
// 439362,
// 439369,
// 439378,
// 439389,
// 439392,
// 439395,
// 439767,
// 440327,
// 440334,
// 440337,
// 440376,
// 440379,
// 457790,
// 459092,
// 459095,
// 459102,
// 459113,
// 459120,
// 459121,
// 459142,
// 459155,
// 459161,
// 459164,
// 459176,
// 459359,
// 461126,
// 461671,
// 480718,
// 480914,
// 480998,
// 481197,
// 481468,
// 481499,
// 481753,
// 481755,
// 481925,
// 482058
482111,
482262,
482300,
482415,
482483,
482699,
482732,
482829,
482980,
482981,
483201,
483279,
483312,
483322,
483494,
483526,
483548,
483884,
483925,
484700,
484701,
484735,
484736,
484764,
484831,
484837,
485073,
485075,
485213,
485221,
485719,
485729,
485730,
485945,
486161,
486184,
486245,
486281,
486611,
486789,
486923,
487032,
487835,
487859,
487864,
487978,
487982,
488001,
488041,
488089,
488125,
488135,
488166,
488231,
488791,
488910,
488928,
489252,
489301,
489343,
489502,
489549,
489551,
489974,
489995,
489998,
490002,
490260,
490750,
491647,
492345,
492373,
492745,
494302,
632919,
690375,
694642,
712219
];


// set up empty Array for us to save results to
const myArray = [];

function fetchUrl(objectId){
    request(url + '/' + objectId, function (error, response, body) {
      console.error('error:', error); // Print the error if one occurred
      console.log('statusCode:', response && response.statusCode); // Print the response status code if a response was received

      let obj = JSON.parse(body);

      console.log(obj.primaryImage);
      let index = myArray.length;
      myArray[index] = {};
      myArray[index]["objectID"] = obj.objectID;
      myArray[index]["title"] = obj.title;
      myArray[index]["date"] = obj.objectBeginDate;
      myArray[index]["primaryImage"] = obj.primaryImage;
      myArray[index]["filename"] = obj.primaryImage.split('/').pop();
    });
}

// call the function for each element in the myObjectIds array
myObjectIds.forEach(objectId => {
    fetchUrl(objectId);
});

// the function inside the setTimeout saves myResults to a JSON
// it will automatically run after 2000 ms
setTimeout(() => {
    fs.writeFileSync('./treeData5.json', JSON.stringify(myArray), 'utf8');
}, 2000);
